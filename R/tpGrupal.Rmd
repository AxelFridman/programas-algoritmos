---
title: "R Notebook"
output: html_notebook
---


```{r}
library("plotly")
library("plot3D")
library(tidyverse) # entorno tidy
library(dplyr) # manejo de datos
library(GGally) # scatterplots multiples
library(rgl) # para graficos 3D
library(dplyr)
```

%>% significa pipeline
x %>% f(y) es lo mismo que f(x,y)
o tambien
y %>% f(x, ., z) es lo mismo que f(x,y,z)

```{r}
df = read.csv("chicos.csv", stringsAsFactors = F)
```
```{r}
indices = (
  ! is.na(df$WEIGHT) &
  ! is.na(df$STATURE) &
  ! is.na(df$SEX) &
  ! is.na(df$RACE) &
  ! is.na(df$AGE.IN.YEARS) &
  ! is.na(df$AGE.IN.MONTHS) &
  df$WEIGHT>0 &
  df$STATURE>0 &
  df$RACE != 0 &
    
  df$WRIST.CIRCUMFERENCE>0 &
  df$HEAD.CIRCUMFERENCE>0 &
  df$SHOULDER.BREADTH>0 &
  df$ELBOW.HAND.LENGTH>0 &
  df$HAND.LENGTH>0 &
  df$UPPER.ARM.CIRCUMFERENCE>0 &
  df$FOOT.LENGTH>0 &
    
  (df$SEX == 1 | df$SEX==2)
    )

dfFiltrados = df[indices,]
dfFiltrados$WEIGHT = dfFiltrados$WEIGHT/10
dfFiltrados$STATURE = dfFiltrados$STATURE/10
dfFiltrados$AGE = dfFiltrados$AGE.IN.MONTHS / 12
mujeres = dfFiltrados[dfFiltrados$SEX==2, ]
hombres = dfFiltrados[dfFiltrados$SEX==1,]
whites = dfFiltrados[dfFiltrados$RACE==1,]
blacks = dfFiltrados[dfFiltrados$RACE==2,]

dfFiltrados = dfFiltrados[ , c("WEIGHT","STATURE", "SEX", "RACE","AGE","WRIST.CIRCUMFERENCE","HEAD.CIRCUMFERENCE","SHOULDER.BREADTH","ELBOW.HAND.LENGTH","HAND.LENGTH","UPPER.ARM.CIRCUMFERENCE","FOOT.LENGTH")]
```

```{r}
unique(df$SEX)
```

```{r}
range(dfFiltrados$AGE)

```

```{r}
View(dfFiltrados)
correlaciones = (cor(dfFiltrados$AGE, dfFiltrados[-c(1)]))
```
```{r}
correlaciones
```




```{r}
plot(dfFiltrados$AGE, dfFiltrados$STATURE, col=dfFiltrados$SEX, xlab = "Edad (anios)", ylab = "Altura en CM",)
```
```{r}
cPuntos = 1000
modAlturaEnEdad = lm(STATURE~poly(AGE,2), data=dfFiltrados)
puntosIntervalo = seq(min(dfFiltrados$AGE), max(dfFiltrados$AGE), (range(dfFiltrados$AGE)[2]- range(dfFiltrados$AGE)[1])/cPuntos)

dataFrameEvaluar = data_frame(1:(cPuntos+1))
dataFrameEvaluar = cbind(dataFrameEvaluar,puntosIntervalo)
colnames(dataFrameEvaluar) = c("ind", "AGE")

plot(dfFiltrados$AGE,dfFiltrados$STATURE, xlab = "Edad en anios", ylab = "Altura en CM", main="Altura en funcion de edad de toda la poblacion")
lines(puntosIntervalo, predict(modAlturaEnEdad, newdata = dataFrameEvaluar), col='red', lwd=3)
```
```{r}
modPesoEnEdad = lm(WEIGHT~poly(AGE,2), data=dfFiltrados)

plot(dfFiltrados$AGE,dfFiltrados$WEIGHT,  xlab = "Edad en anios", ylab = "PESO en kg", main="Peso en funcion de edad de toda la poblacion")
lines(puntosIntervalo, predict(modPesoEnEdad, newdata = dataFrameEvaluar), col='red', lwd=3)
```
```{r}

modPesoEnEdadMuj = lm(WEIGHT~poly(AGE,2), data=mujeres)

plot(mujeres$AGE,mujeres$WEIGHT,  xlab = "Edad en anios", ylab = "PESO en kg", main="Peso en funcion de edad de mujeres")
lines(puntosIntervalo, predict(modPesoEnEdadMuj, newdata = dataFrameEvaluar), col='red', lwd=3)
```
```{r}

modPesoEnEdadHom = lm(WEIGHT~poly(AGE,2), data=hombres)

plot(hombres$AGE,hombres$WEIGHT,  xlab = "Edad en anios", ylab = "PESO en kg", main="Peso en funcion de edad de hombres y mujeres", col='blue')

points(mujeres$AGE,mujeres$WEIGHT,  xlab = "Edad en anios", ylab = "PESO en kg", main="Peso en funcion de edad de hombres", col='red')

lines(puntosIntervalo, predict(modPesoEnEdadHom, newdata = dataFrameEvaluar), col='light blue', lwd=3)
lines(puntosIntervalo, predict(modPesoEnEdadMuj, newdata = dataFrameEvaluar), col='pink', lwd=3)

```

```{r}

modAlturaEnEdadHom = lm(STATURE~poly(AGE,2), data=hombres)
modAlturaEnEdadMuj = lm(STATURE~poly(AGE,2), data=mujeres)

plot(hombres$AGE,hombres$STATURE,  xlab = "Edad en anios", ylab = "Altura en cm", main="Altura en funcion de edad de hombres y mujeres", col='blue')

points(mujeres$AGE,mujeres$STATURE, col='red')

lines(puntosIntervalo, predict(modAlturaEnEdadHom, newdata = dataFrameEvaluar), col='light blue', lwd=3)
lines(puntosIntervalo, predict(modAlturaEnEdadMuj, newdata = dataFrameEvaluar), col='pink', lwd=3)

```
```{r}

modAlturaEnEdadBlan = lm(STATURE~poly(AGE,2), data=whites)
modAlturaEnEdadNeg = lm(STATURE~poly(AGE,2), data=blacks)

plot(whites$AGE,whites$STATURE,  xlab = "Edad en anios", ylab = "Altura en cm", main="Altura en funcion de edad de blancos y de color")

points(blacks$AGE,blacks$STATURE, pch=19)

lines(puntosIntervalo, predict(modAlturaEnEdadBlan, newdata = dataFrameEvaluar), col='light blue', lwd=3)
lines(puntosIntervalo, predict(modAlturaEnEdadNeg, newdata = dataFrameEvaluar), col='pink', lwd=3)

```
df$WRIST.CIRCUMFERENCE>0 &
  df$HEAD.CIRCUMFERENCE>0 &
  df$SHOULDER.BREADTH>0 &
  df$ELBOW.HAND.LENGTH>0 &
  df$HAND.LENGTH>0 &
  df$UPPER.ARM.CIRCUMFERENCE>0 &
  df$FOOT.LENGTH>0 &
```{r}
#par(mfrow=c(2,2))
plot(dfFiltrados$AGE,dfFiltrados$WRIST.CIRCUMFERENCE,  xlab = "Edad en anios", ylab = "Cintura  en cm", col= dfFiltrados$SEX, main="Circunferencia cintura en funcion de edad toda la poblacion")

```
```{r}
plot(dfFiltrados$AGE,dfFiltrados$SHOULDER.BREADTH,  xlab = "Edad en anios", ylab = "SHOULDER.BREADTH en cm", col= dfFiltrados$SEX, main="SHOULDER.BREADTH en funcion de edad toda la poblacion")

```
```{r}
plot(dfFiltrados$AGE,dfFiltrados$ELBOW.HAND.LENGTH,  xlab = "Edad en anios", ylab = "ELBOW.HAND.LENGTH  en cm", col= dfFiltrados$SEX, main="ELBOW.HAND.LENGTH en funcion de edad toda la poblacion")

```

```{r}
plot(dfFiltrados$AGE,dfFiltrados$HEAD.CIRCUMFERENCE,  xlab = "Edad en anios", ylab = "HEAD.CIRCUMFERENCE  en cm", col= dfFiltrados$SEX, main="HEAD.CIRCUMFERENCE en funcion de edad toda la poblacion")

```
HAND.LENGTH
```{r}
plot(dfFiltrados$AGE,dfFiltrados$HAND.LENGTH,  xlab = "Edad en anios", ylab = "HAND.LENGTH  en cm", col= dfFiltrados$SEX, main="HAND.LENGTH en funcion de edad toda la poblacion")

```
UPPER.ARM.CIRCUMFERENCE
```{r}
plot(dfFiltrados$AGE,dfFiltrados$UPPER.ARM.CIRCUMFERENCE,  xlab = "Edad en anios", ylab = "UPPER.ARM.CIRCUMFERENCE  en cm", col= dfFiltrados$SEX, main="UPPER.ARM.CIRCUMFERENCE en funcion de edad toda la poblacion")

```
```{r}
plot(dfFiltrados$AGE,dfFiltrados$FOOT.LENGTH,  xlab = "Edad en anios", ylab = "FOOT.LENGTH  en cm", col= dfFiltrados$SEX, main="FOOT.LENGTH en funcion de edad toda la poblacion", xlim=c(16,17))

```
```{r}

modPesoEnEdadBlan = lm(WEIGHT~poly(AGE,2), data=whites)
modPesoEnEdadNeg = lm(WEIGHT~poly(AGE,2), data=blacks)

plot(whites$AGE,whites$WEIGHT,  xlab = "Edad en anios", ylab = "Peso en KG", main="Peso en funcion de edad de blancos y de color")

points(blacks$AGE,blacks$WEIGHT, pch=19)

lines(puntosIntervalo, predict(modPesoEnEdadBlan, newdata = dataFrameEvaluar), col='light blue', lwd=3)
lines(puntosIntervalo, predict(modPesoEnEdadNeg, newdata = dataFrameEvaluar), col='pink', lwd=3)

```

```{r}
table(dfFiltrados$RACE)
#Cinco niveles, WHITE = 1, BLACK = 2, ORIENTAL = 3, AMERICAN INDIAN = 4, MIXED = 5.
#Absoluta disparidad de muestreo en cuanto a raza.

table(dfFiltrados$SEX)
#En cuanto a sexo no
```


A que edad pegan "el estiron" los hombres y cuando las mujeres? existe un momento concreto? Ademas de altura, que otras medidas cambian considerablemente? (medida de cintura en mujeres por ej, ensanchamiento de espalda hombres?)
```{r}
crecimientos = data_frame( 2:19)
for(i in 2:12){
  crecimientos = cbind(crecimientos, 2:19)
}

colnames(crecimientos) = c("WEIGHT","STATURE", "SEX", "RACE","AGE","WRIST.CIRCUMFERENCE","HEAD.CIRCUMFERENCE","SHOULDER.BREADTH","ELBOW.HAND.LENGTH","HAND.LENGTH","UPPER.ARM.CIRCUMFERENCE","FOOT.LENGTH")


listaModelos <- c()
for(i in 3:20){
  dfEdad <- dfFiltrados[(dfFiltrados$AGE > (i - 1)) &
                                             (dfFiltrados$AGE < i),]
  if(nrow(dfEdad) > 0){
    for (j in (1:ncol(crecimientos))) {
      if(colnames(crecimientos)[j]!="AGE"){
      f = paste(colnames(crecimientos)[j], "AGE", sep="~")
      formu = formula(f)
      modelo = lm( formu, dfEdad)
      crecimientos[i-2,j] = modelo$coefficients[[2]]
      }
    }
  }
}
```
```{r}

```

